---
title: " Simulate Reccurent Event Data with reThReg Package"
author: Yingfa Xie
date: "`r Sys.Date()`"
output:
  rmarkdown::html_document:
    toc: true
    toc_depth: 2
    toc_float: true
bibliography: ../inst/bib/reThReg.bib
vignette: >
  %\VignetteIndexEntry{ Simulate Reccurent Event Data with reThReg Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

In this vignettes, we briefly introduce how to simulate recurrent event data 
from the proposed model with the **reThReg** package. The function `simData()` 
provide an interface for simulating recurrent event times. The details for 
using `simData()` are provided.


# Introduction 

## Sampling method 
  To be updated.

# Getting Started

```{r}
library(reThReg)
options(digits = 3)
set.seed(1)
```

## Load simulated covariates data and follow-up times for subjects

```{r}
head(simCovData)
```

##  Simulating from proposed models

### Dependent frailties for volatility and upper reflection barrier

```{r}
size <- nrow(simCovData)
endTime <- simCovData$censorTime
## deal with outlier for numerical stable
X <- as.matrix(cbind(rep(1, size), simCovData[, c("x1", "x2")]))

set.seed(1)
df <- simData(size = size,
              endTime = endTime,
              X = X,
              kappaCoef = c(2.9, 0.2, -0.1),
              sigmaCoef = c(0.9, -0.2, -0.1),
              theta = c(0.4, 0.5),
              gamma = -0.2,
              x0 = 10, 
              nu = 3.9)
head(df, 10)
```


### Independent frailties for volatility and upper reflection barrier
For simulating from independent frailties model, the parameter $\gamma$ could be assigned to be zero. 
```{r}
size <- nrow(simCovData)
endTime <- simCovData$censorTime
## need to truncate outlier for numerical stable
X <- as.matrix(cbind(rep(1, size), simCovData[, c("x1", "x2")]))
set.seed(1)
df_indep <- simData(size = size,
              endTime = endTime,
              X = X,
              kappaCoef = c(2.9, 0.2, -0.1),
              sigmaCoef = c(0.9, -0.2, -0.1),
              theta = c(0.4, 0.5),
              gamma = 0,
              x0 = 10, 
              nu = 3.9)
head(df_indep, 10)
```


### Perfect correlated frailties for volatility and upper reflection barrier
For simulating from perfect correlated frailties for volatility and upper 
reflection barrier model, the variance parameter could be assigned to be 
$\theta = c(\theta_1, 0)$, which share the same frailty for volatility and 
upper reflection barrier but with different coefficient.
```{r}
size <- nrow(simCovData)
endTime <- simCovData$censorTime
## need to truncate outlier for numerical stable
X <- as.matrix(cbind(rep(1, size), simCovData[, c("x1", "x2")]))
set.seed(1)
df_perfCor <- simData(size = size,
              endTime = endTime,
              X = X,
              kappaCoef = c(2.9, 0.2, -0.1),
              sigmaCoef = c(0.9, -0.2, -0.1),
              theta = c(0.4, 0),
              gamma = -1,
              x0 = 10, 
              nu = 3.9)
head(df_perfCor, 10)
```